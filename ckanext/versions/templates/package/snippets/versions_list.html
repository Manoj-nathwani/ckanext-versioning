{% block versions_list %}

{% set pkg = c.pkg_dict %}
{% resource 'versions/dataset_versions.js' %}

<div id="versions-container"
    data-module="dataset_version_controls"
    data-module-api-url="{{ h.url_for('api.action', ver=3, logic_function='') }}"
    data-module-package-id="{{ pkg.id }}"
    data-module-package-url="{{ h.url_for(controller='package', action='read', id=pkg.name) }}">

  {% if not c.current_version %}
    <h3>Versions</h3>
    {% if pkg.get('versions', []) | length > 0 %}
      <table class="table table-striped table-bordered table-condensed">
        <thead>
          <tr>
            <th scope="col">Version</th>
            <th scope="col">Description</th>
            <th scope="col">Published</th>
          </tr>
        </thead>
        <tbody>
        {% for version in pkg.get('versions', []) %}
          <tr>
            <th scope="row" class="dataset-label">
              <a href="{{ h.dataset_version_get_show_url(pkg.name, version) }}">
                {{ version.name }}
              </a>
            </th>
            <td class="dataset-details">
              {{ version.description }}
            </td>
            <td class="dataset-details">
              {% snippet 'snippets/local_friendly_datetime.html', datetime_obj=version.created %}
            </td>
          </tr>
        {% endfor %}
        </tbody>
      </table>
    {% else %}
      <p>{{ _('There are no versions available for this dataset') }}</p>
    {% endif %}
  {% endif %}

  {% if c.current_version %}
    {% if h.check_access('dataset_version_delete', {'dataset': pkg.id}) %}
      <button data-version-id="{{ c.current_version.id }}"
              data-version-name="{{ c.current_version.name }}"
              class="delete-version-btn btn btn-primary">
        {{ _('Delete Version') }}
      </button>
    {% endif %}
  {% else %}
    {% if h.check_access('dataset_version_create', {'dataset': pkg.id}) %}
      <!-- Button trigger modal -->
      <button type="button" class="btn btn-primary" data-toggle="modal" data-target="#createVersionModal">
        {{ _('Create Version') }}
      </button>

      <!-- Modal -->
      <div class="modal fade" id="createVersionModal" tabindex="-1" role="dialog" aria-labelledby="createVersionModalLabel">
        <div class="modal-dialog" role="document">
          <div class="modal-content">
            <form class="create-version-form">
              <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                <h4 class="modal-title" id="createVersionModalLabel">Create a new version pointing to the current state of this dataset</h4>
              </div>
              <div class="modal-body">
                <div class="form-group">
                  <label for="version_name">Version name</label>
                  <input type="text" class="form-control" id="version_name" name="version_name" placeholder="version 1.2" required>
                </div>
                <div class="form-group">
                  <label for="version-details">Description</label>
                  <textarea id="version-details" name="details" class="form-control" rows="3"></textarea>
                </div>
              </div>
              <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
                <button type="submit" class="btn btn-primary">Create Version</button>
              </div>
            </form>
          </div>
        </div>
      </div>
    {% endif %}
  {% endif %}

</div>

{% endblock %}
